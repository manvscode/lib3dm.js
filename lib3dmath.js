
var mathematics={SCALAR_EPSILON:1e-9,HALF_PI:Math.PI/2.0,PI:Math.PI,TWO_PI:2*Math.PI,RADIANS_PER_DEGREE:(Math.PI/180.0),DEGREES_PER_RANDIAN:(180.0/Math.PI),to_radians:function(degrees){return degrees*RADIANS_PER_DEGREE;},to_degrees:function(radians){return radians*DEGREES_PER_RANDIAN;},integer_max:function(x,y){return(x)^(((x)^(y))&-((x)<(y)));},integer_min:function(x,y){return(y)^(((x)^(y))&-((x)<(y)));},linear_interpolation:function(a,x0,x1){return(x0)+(a)*((x1)-(x0));},lerp:this.linear_interpolation,bilear_interpolation:function(a,b,x0,x1,x2,x3){return this.lerp(b,this.lerp(a,x0,x1),this.lerp(a,x2,x3));},bilerp:this.bilear_interpolation,uniform:function(){return Math.random();},uniform_range:function(min,max){var diff=max-min;return min+this.uniform()*diff;},uniform_unit:function(){return 2*this.uniform()-1;},clamp:function(value,min,max){if(value>max)
{return max;}
else if(value<min)
{return min;}
return value;}};function vec2(x,y){this.x=x;this.y=y;}
vec2.VEC2_ZERO=vec2(0,0);vec2.VEC2_XUNIT=vec2(1,0);vec2.VEC2_YUNIT=vec2(0,1);vec2.prototype.add=function(v){return new vec2(this.x+v.x,this.y+v.y);};vec2.prototype.subtract=function(v){return new vec2(this.x-v.x,this.y-v.y);};vec2.prototype.multiply=function(s){return new vec2(this.x*s,this.y*s);};vec2.prototype.scale=function(s){return this.multiply(s);};vec2.prototype.dot_product=function(v){return this.x*v.x+this.y*v.y;};vec2.prototype.cross_product=function(v){return new vec2(this.y,-this.x);};vec2.prototype.determinant=function(v){return this.x*v.y-v.x*this.y;};vec2.prototype.magnitude=function(){return Math.sqrt(this.x*this.x+this.y*this.y);};vec2.prototype.distance=function(v){return Math.sqrt((this.x-v.x)*(this.x-v.x)+
(this.y-v.y)*(this.y-v.y));};vec2.prototype.angle=function(v){var dot_product=this.dot_product(v);var a_length=this.magnitude();var b_length=v.magnitude();return Math.acos(dot_product/(a_length*b_length));};vec2.prototype.normalize=function(){var inverse_length=1.0/this.magnitude();this.x*=inverse_length;this.y*=inverse_length;};vec2.prototype.is_normalized=function(){return(Math.abs(this.x-1.0)<mathematics.SCALAR_EPSILON)&&(Math.abs(this.y-1.0)<mathematics.SCALAR_EPSILON);};vec2.prototype.negate=function(){this.x=-this.x;this.y=-this.y;};vec2.prototype.zero=function(){this.x=0.0;this.y=0.0;};vec2.prototype.toString=function(){return"("+this.x+", "+this.y+")";};function vec3(x,y,z){this.x=x;this.y=y;this.z=z;}
vec3.VEC3_ZERO=vec3(0,0,0);vec3.VEC3_XUNIT=vec3(1,0,0);vec3.VEC3_YUNIT=vec3(0,1,0);vec3.VEC3_ZUNIT=vec3(0,0,1);vec3.prototype.add=function(v){return new vec3(this.x+v.x,this.y+v.y,this.z+v.z);};vec3.prototype.subtract=function(v){return new vec3(this.x-v.x,this.y-v.y,this.z-v.z);};vec3.prototype.multiply=function(s){return new vec3(this.x*s,this.y*s,this.z*s);};vec3.prototype.scale=function(s){return this.multiply(s);};vec3.prototype.dot_product=function(v){return this.x*v.x+this.y*v.y+this.z*v.z;};vec3.prototype.cross_product=function(v){return new vec3(this.y*v.z-this.z*v.y,this.z*v.x-this.x*v.z,this.x*v.y-this.y*v.x);};vec3.prototype.magnitude=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*v.z);};vec3.prototype.distance=function(v){return Math.sqrt((this.x-v.x)*(this.x-v.x)+
(this.y-v.y)*(this.y-v.y)+
(this.z-v.z)*(this.z-v.z));};vec3.prototype.angle=function(v){var dot_product=this.dot_product(v);var a_length=this.magnitude();var b_length=v.magnitude();return Math.acos(dot_product/(a_length*b_length));};vec3.prototype.normalize=function(){var inverse_length=1.0/this.magnitude();this.x*=inverse_length;this.y*=inverse_length;this.z*=inverse_length;};vec3.prototype.is_normalized=function(){return(Math.abs(this.x-1.0)<mathematics.SCALAR_EPSILON)&&(Math.abs(this.y-1.0)<mathematics.SCALAR_EPSILON)&&(Math.abs(this.z-1.0)<mathematics.SCALAR_EPSILON);};vec3.prototype.negate=function(){this.x=-this.x;this.y=-this.y;this.z=-this.z;};vec3.prototype.zero=function(){this.x=0.0;this.y=0.0;this.z=0.0;};vec3.prototype.toString=function(){return"("+this.x+", "+this.y+", "+this.z+")";};function vec4(x,y,z,w){this.x=x;this.y=y;this.z=z;this.w=w;}
vec4.VEC4_ZERO=vec4(0,0,0,0);vec4.VEC4_XUNIT=vec4(1,0,0,0);vec4.VEC4_YUNIT=vec4(0,1,0,0);vec4.VEC4_ZUNIT=vec4(0,0,1,0);vec4.VEC4_WUNIT=vec4(0,0,0,1);vec4.prototype.add=function(v){return new vec4(this.x+v.x,this.y+v.y,this.z+v.z,this.w+v.w);};vec4.prototype.subtract=function(v){return new vec4(this.x-v.x,this.y-v.y,this.z-v.z,this.w-v.w);};vec4.prototype.multiply=function(s){return new vec4(this.x*s,this.y*s,this.z*s,this.w*s);};vec4.prototype.scale=function(s){return this.multiply(s);};vec4.prototype.dot_product=function(v){return this.x*v.x+this.y*v.y+this.z*v.z+this.w*v.w;};vec4.prototype.magnitude=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*v.z+this.w*v.w);};vec4.prototype.distance=function(v){return Math.sqrt((this.x-v.x)*(this.x-v.x)+
(this.y-v.y)*(this.y-v.y)+
(this.z-v.z)*(this.z-v.z)+
(this.w-v.w)*(this.w-v.w));};vec4.prototype.angle=function(v){var dot_product=this.dot_product(v);var a_length=this.magnitude();var b_length=v.magnitude();return Math.acos(dot_product/(a_length*b_length));};vec4.prototype.normalize=function(){var inverse_length=1.0/this.magnitude();this.x*=inverse_length;this.y*=inverse_length;this.z*=inverse_length;this.w*=inverse_length;};vec4.prototype.is_normalized=function(){return(Math.abs(this.x-1.0)<mathematics.SCALAR_EPSILON)&&(Math.abs(this.y-1.0)<mathematics.SCALAR_EPSILON)&&(Math.abs(this.z-1.0)<mathematics.SCALAR_EPSILON)&&(Math.abs(this.w-1.0)<mathematics.SCALAR_EPSILON);};vec4.prototype.negate=function(){this.x=-this.x;this.y=-this.y;this.z=-this.z;this.w=-this.w;};vec4.prototype.zero=function(){this.x=0.0;this.y=0.0;this.z=0.0;this.w=0.0;};vec4.prototype.toString=function(){return"("+this.x+", "+this.y+", "+this.z+", "+this.w+")";};function mat2(a,b,c,d){this.m=[a,b,c,d];}
mat2.MAT2_IDENTITY=mat2(1,0,0,1);mat2.MAT2_ZERO=mat2(0,0,0,0);mat2.prototype.identity=function(){return this.m=MAT2_IDENITY;};mat2.prototype.zero=function(){return this.m=MAT2_ZERO;};mat2.prototype.determinant=function(){return this.m[0]*this.m[3]-this.m[1]*this.m[2];};mat2.prototype.multiply_matrix=function(m){return new mat2(this.m[0]*m.m[0]+this.m[2]*m.m[1],this.m[1]*m.m[0]+this.m[3]*m.m[1],this.m[0]*m.m[2]+this.m[2]*m.m[3],this.m[1]*m.m[2]+this.m[3]*m.m[3]);};mat2.prototype.multiply_vector=function(v){return new vec2(this.m[0]*v.x+this.m[2]*v.y,this.m[1]*v.x+this.m[3]*v.y);};mat2.prototype.multiply=function(o){if(o instanceof vec2){return this.multiply_vector(o);}
else{return this.multiply_matrix(o);}};mat2.prototype.invert=function(){var det=this.determinant();if(det>mathematics.SCALAR_EPSILON)
{{var tmp=this.m[0];this.m[0]=this.m[3];this.m[3]=tmp;tmp=this.m[1];this.m[1]=-this.m[2];this.m[2]=-tmp;}
this.m[0]/=det;this.m[1]/=det;this.m[2]/=det;this.m[3]/=det;return true;}
return false;};mat2.prototype.transpose=function(){var tmp=this.m[1];this.m[1]=this.m[2];this.m[2]=tmp;};mat2.prototype.x_vector=function(){var arr=this.m.slice(0,2);return new vec2(arr[0],arr[1]);};mat2.prototype.y_vector=function(){var arr=this.m.slice(2,4);return new vec2(arr[0],arr[1]);};mat2.prototype.toString=function(){return"|"+this.m[0]+" "+this.m[2]+"|\n"+"|"+this.m[1]+" "+this.m[3]+"|\n";};function mat3(a,b,c,d,e,f,g,h,i){this.m=[a,b,c,d,e,f,g,h,i];}
mat3.MAT3_IDENTITY=mat3(1,0,0,0,1,0,0,0,1);mat3.MAT3_ZERO=mat3(0,0,0,0,0,0,0,0,0);mat3.prototype.identity=function(){return this.m=MAT3_IDENITY;};mat3.prototype.zero=function(){return this.m=MAT3_ZERO;};mat3.prototype.determinant=function(){return this.m[0]*this.m[4]*this.m[8]+
this.m[3]*this.m[7]*this.m[2]+
this.m[6]*this.m[1]*this.m[5]-
this.m[6]*this.m[4]*this.m[2]-
this.m[3]*this.m[1]*this.m[8]-
this.m[0]*this.m[7]*this.m[5];};mat3.prototype.multiply_matrix=function(m){return new mat3(this.m[0]*m.m[0]+this.m[3]*m.m[1]+this.m[6]*m.m[2],this.m[1]*m.m[0]+this.m[4]*m.m[1]+this.m[7]*m.m[2],this.m[2]*m.m[0]+this.m[5]*m.m[1]+this.m[8]*m.m[2],this.m[0]*m.m[3]+this.m[3]*m.m[4]+this.m[6]*m.m[5],this.m[1]*m.m[3]+this.m[4]*m.m[4]+this.m[7]*m.m[5],this.m[2]*m.m[3]+this.m[5]*m.m[4]+this.m[8]*m.m[5],this.m[0]*m.m[6]+this.m[3]*m.m[7]+this.m[6]*m.m[8],this.m[1]*m.m[6]+this.m[4]*m.m[7]+this.m[7]*m.m[8],this.m[2]*m.m[6]+this.m[5]*m.m[7]+this.m[8]*m.m[8]);};mat3.prototype.multiply_vector=function(v){return new mat3(this.m[0]*v.x+this.m[3]*v.y+this.m[6]*v.z,this.m[1]*v.x+this.m[4]*v.y+this.m[7]*v.z,this.m[2]*v.x+this.m[5]*v.y+this.m[8]*v.z);};mat3.prototype.multiply=function(o){if(o instanceof vec3){return this.multiply_vector(o);}
else{return this.multiply_matrix(o);}};mat3.prototype.cofactor=function(){return new mat3(+(this.m[4]*this.m[8]-this.m[5]*this.m[7]),-(this.m[3]*this.m[8]-this.m[5]*this.m[6]),+(this.m[3]*this.m[7]-this.m[4]*this.m[6]),-(this.m[1]*this.m[8]-this.m[2]*this.m[7]),+(this.m[0]*this.m[8]-this.m[2]*this.m[6]),-(this.m[0]*this.m[7]-this.m[1]*this.m[6]),+(this.m[1]*this.m[5]-this.m[2]*this.m[4]),-(this.m[0]*this.m[5]-this.m[2]*this.m[3]),+(this.m[0]*this.m[4]-this.m[1]*this.m[3]));};mat3.prototype.transpose=function(){var tmp1=this.m[1];var tmp2=this.m[2];var tmp3=this.m[5];this.m[1]=this.m[3];this.m[2]=this.m[6];this.m[5]=this.m[7];this.m[3]=tmp1;this.m[6]=tmp2;this.m[7]=tmp3;};mat3.prototype.adjoint=function(){var cofactor_matrix=this.cofactor();cofactor_matrix.transpose();this.m=cofactor_matrix.m;};mat3.prototype.invert=function(){var det=this.determinant();if(Math.abs(det)>mathematics.SCALAR_EPSILON)
{this.adjoint();this.m[0]/=det;this.m[1]/=det;this.m[2]/=det;this.m[3]/=det;this.m[4]/=det;this.m[5]/=det;this.m[6]/=det;this.m[7]/=det;this.m[8]/=det;return true;}
return false;};mat3.prototype.x_vector=function(){var arr=this.m.slice(0,4);return new vec3(arr[0],arr[1],arr[2]);};mat3.prototype.y_vector=function(){var arr=this.m.slice(3,6);return new vec3(arr[0],arr[1],arr[2]);};};mat3.prototype.z_vector=function(){var arr=this.m.slice(6,9);return new vec3(arr[0],arr[1],arr[2]);};};mat3.prototype.toString=function(){return"|"+this.m[0]+" "+this.m[3]+" "+this.m[6]+"|\n"+"|"+this.m[1]+" "+this.m[4]+" "+this.m[7]+"|\n"+"|"+this.m[2]+" "+this.m[5]+" "+this.m[8]+"|\n";};function mat4(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){this.m=[a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p];}
mat4.MAT4_IDENTITY=mat4(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);mat4.MAT4_ZERO=mat4(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);mat4.prototype.identity=function(){return this.m=MAT4_IDENITY;};mat4.prototype.zero=function(){return this.m=MAT4_ZERO;};mat4.prototype.determinant=function(){var d1=this.m[5]*(this.m[10]*this.m[15]-this.m[14]*this.m[11])-this.m[6]*(this.m[9]*this.m[15]-this.m[13]*this.m[11])+this.m[7]*(this.m[9]*this.m[14]-this.m[13]*this.m[10]);var d2=this.m[4]*(this.m[10]*this.m[15]-this.m[14]*this.m[11])-this.m[6]*(this.m[8]*this.m[15]-this.m[12]*this.m[11])+this.m[7]*(this.m[8]*this.m[14]-this.m[12]*this.m[10]);var d3=this.m[4]*(this.m[9]*this.m[15]-this.m[13]*this.m[11])-this.m[5]*(this.m[8]*this.m[15]-this.m[12]*this.m[11])+this.m[7]*(this.m[8]*this.m[13]-this.m[12]*this.m[9]);var d4=this.m[4]*(this.m[9]*this.m[14]-this.m[13]*this.m[10])-this.m[5]*(this.m[8]*this.m[14]-this.m[12]*this.m[10])+this.m[6]*(this.m[8]*this.m[13]-this.m[12]*this.m[9]);return this.m[0]*d1-this.m[1]*d2+this.m[2]*d3-this.m[3]*d4;};mat4.prototype.multiply_matrix=function(m){return new mat4(this.m[0]*m.m[0]+this.m[4]*m.m[1]+this.m[8]*m.m[2]+this.m[12]*m.m[3],this.m[1]*m.m[0]+this.m[5]*m.m[1]+this.m[9]*m.m[2]+this.m[13]*m.m[3],this.m[2]*m.m[0]+this.m[6]*m.m[1]+this.m[10]*m.m[2]+this.m[14]*m.m[3],this.m[3]*m.m[0]+this.m[7]*m.m[1]+this.m[11]*m.m[2]+this.m[15]*m.m[3],this.m[0]*m.m[4]+this.m[4]*m.m[5]+this.m[8]*m.m[6]+this.m[12]*m.m[7],this.m[1]*m.m[4]+this.m[5]*m.m[5]+this.m[9]*m.m[6]+this.m[13]*m.m[7],this.m[2]*m.m[4]+this.m[6]*m.m[5]+this.m[10]*m.m[6]+this.m[14]*m.m[7],this.m[3]*m.m[4]+this.m[7]*m.m[5]+this.m[11]*m.m[6]+this.m[15]*m.m[7],this.m[0]*m.m[8]+this.m[4]*m.m[9]+this.m[8]*m.m[10]+this.m[12]*m.m[11],this.m[1]*m.m[8]+this.m[5]*m.m[9]+this.m[9]*m.m[10]+this.m[13]*m.m[11],this.m[2]*m.m[8]+this.m[6]*m.m[9]+this.m[10]*m.m[10]+this.m[14]*m.m[11],this.m[3]*m.m[8]+this.m[7]*m.m[9]+this.m[11]*m.m[10]+this.m[15]*m.m[11],this.m[0]*m.m[12]+this.m[4]*m.m[13]+this.m[8]*m.m[14]+this.m[12]*m.m[15],this.m[1]*m.m[12]+this.m[5]*m.m[13]+this.m[9]*m.m[14]+this.m[13]*m.m[15],this.m[2]*m.m[12]+this.m[6]*m.m[13]+this.m[10]*m.m[14]+this.m[14]*m.m[15],this.m[3]*m.m[12]+this.m[7]*m.m[13]+this.m[11]*m.m[14]+this.m[15]*m.m[15]);};mat4.prototype.multiply_vector=function(v){return new vec4(this.m[0]*v.x+this.m[4]*v.y+this.m[8]*v.z+this.m[12]*v.w,this.m[1]*v.x+this.m[5]*v.y+this.m[9]*v.z+this.m[13]*v.w,this.m[2]*v.x+this.m[6]*v.y+this.m[10]*v.z+this.m[14]*v.w,this.m[3]*v.x+this.m[7]*v.y+this.m[11]*v.z+this.m[15]*v.w);};mat4.prototype.multiply=function(o){if(o instanceof vec4){return this.multiply_vector(o);}
else{return this.multiply_matrix(o);}};mat4.prototype.cofactor=function(){return new mat4(+(this.m[5]*(this.m[10]*this.m[15]-this.m[14]*this.m[11])-this.m[6]*(this.m[9]*this.m[15]-this.m[13]*this.m[11])+this.m[7]*(this.m[9]*this.m[14]-this.m[13]*this.m[10])),-(this.m[4]*(this.m[10]*this.m[15]-this.m[14]*this.m[11])-this.m[6]*(this.m[8]*this.m[15]-this.m[12]*this.m[11])+this.m[7]*(this.m[8]*this.m[14]-this.m[12]*this.m[10])),+(this.m[4]*(this.m[9]*this.m[15]-this.m[13]*this.m[11])-this.m[5]*(this.m[8]*this.m[15]-this.m[12]*this.m[11])+this.m[7]*(this.m[8]*this.m[13]-this.m[12]*this.m[9])),-(this.m[4]*(this.m[9]*this.m[14]-this.m[13]*this.m[10])-this.m[5]*(this.m[8]*this.m[14]-this.m[12]*this.m[10])+this.m[6]*(this.m[8]*this.m[13]-this.m[12]*this.m[9])),-(this.m[1]*(this.m[10]*this.m[15]-this.m[14]*this.m[11])-this.m[2]*(this.m[9]*this.m[15]-this.m[13]*this.m[11])+this.m[3]*(this.m[9]*this.m[14]-this.m[13]*this.m[10])),+(this.m[0]*(this.m[10]*this.m[15]-this.m[14]*this.m[11])-this.m[2]*(this.m[8]*this.m[15]-this.m[12]*this.m[11])+this.m[3]*(this.m[8]*this.m[14]-this.m[12]*this.m[10])),-(this.m[0]*(this.m[9]*this.m[15]-this.m[13]*this.m[11])-this.m[1]*(this.m[8]*this.m[15]-this.m[12]*this.m[11])+this.m[3]*(this.m[8]*this.m[13]-this.m[12]*this.m[9])),+(this.m[0]*(this.m[9]*this.m[14]-this.m[13]*this.m[10])-this.m[1]*(this.m[8]*this.m[14]-this.m[12]*this.m[10])+this.m[2]*(this.m[8]*this.m[13]-this.m[12]*this.m[9])),+(this.m[1]*(this.m[6]*this.m[15]-this.m[14]*this.m[7])-this.m[2]*(this.m[5]*this.m[15]-this.m[13]*this.m[7])+this.m[3]*(this.m[5]*this.m[14]-this.m[13]*this.m[6])),-(this.m[0]*(this.m[6]*this.m[15]-this.m[14]*this.m[7])-this.m[2]*(this.m[4]*this.m[15]-this.m[12]*this.m[7])+this.m[3]*(this.m[4]*this.m[14]-this.m[12]*this.m[6])),+(this.m[0]*(this.m[5]*this.m[15]-this.m[13]*this.m[7])-this.m[1]*(this.m[4]*this.m[15]-this.m[12]*this.m[7])+this.m[3]*(this.m[4]*this.m[13]-this.m[12]*this.m[5])),-(this.m[0]*(this.m[5]*this.m[14]-this.m[13]*this.m[6])-this.m[1]*(this.m[4]*this.m[14]-this.m[12]*this.m[6])+this.m[2]*(this.m[4]*this.m[13]-this.m[12]*this.m[5])),-(this.m[1]*(this.m[6]*this.m[11]-this.m[10]*this.m[7])-this.m[2]*(this.m[5]*this.m[11]-this.m[9]*this.m[7])+this.m[3]*(this.m[5]*this.m[10]-this.m[9]*this.m[6])),+(this.m[0]*(this.m[6]*this.m[11]-this.m[10]*this.m[7])-this.m[2]*(this.m[4]*this.m[11]-this.m[8]*this.m[7])+this.m[3]*(this.m[4]*this.m[10]-this.m[8]*this.m[6])),-(this.m[0]*(this.m[5]*this.m[11]-this.m[9]*this.m[7])-this.m[1]*(this.m[4]*this.m[11]-this.m[8]*this.m[7])+this.m[3]*(this.m[4]*this.m[9]-this.m[8]*this.m[5])),+(this.m[0]*(this.m[5]*this.m[10]-this.m[9]*this.m[6])-this.m[1]*(this.m[4]*this.m[10]-this.m[8]*this.m[6])+this.m[2]*(this.m[4]*this.m[9]-this.m[8]*this.m[5])));};mat4.prototype.transpose=function(){var tmp1=this.m[1];var tmp2=this.m[2];var tmp3=this.m[3];var tmp4=this.m[6];var tmp5=this.m[7];var tmp6=this.m[11];this.m[1]=this.m[4];this.m[2]=this.m[8];this.m[3]=this.m[12];this.m[6]=this.m[9];this.m[7]=this.m[13];this.m[11]=this.m[14];this.m[4]=tmp1;this.m[8]=tmp2;this.m[12]=tmp3;this.m[9]=tmp4;this.m[13]=tmp5;this.m[14]=tmp6;};mat4.prototype.adjoint=function(){var cofactor_matrix=this.cofactor();cofactor_matrix.transpose();this.m=cofactor_matrix.m;};mat4.prototype.invert=function(){var d1=this.m[5]*(this.m[10]*this.m[15]-this.m[14]*this.m[11])-this.m[6]*(this.m[9]*this.m[15]-this.m[13]*this.m[11])+this.m[7]*(this.m[9]*this.m[14]-this.m[13]*this.m[10]);var d2=this.m[4]*(this.m[10]*this.m[15]-this.m[14]*this.m[11])-this.m[6]*(this.m[8]*this.m[15]-this.m[12]*this.m[11])+this.m[7]*(this.m[8]*this.m[14]-this.m[12]*this.m[10]);var d3=this.m[4]*(this.m[9]*this.m[15]-this.m[13]*this.m[11])-this.m[5]*(this.m[8]*this.m[15]-this.m[12]*this.m[11])+this.m[7]*(this.m[8]*this.m[13]-this.m[12]*this.m[9]);var d4=this.m[4]*(this.m[9]*this.m[14]-this.m[13]*this.m[10])-this.m[5]*(this.m[8]*this.m[14]-this.m[12]*this.m[10])+this.m[6]*(this.m[8]*this.m[13]-this.m[12]*this.m[9]);var det=this.m[0]*d1-this.m[1]*d2+this.m[2]*d3-this.m[3]*d4;if(Math.abs(det)>mathematics.SCALAR_EPSILON)
{var cofactor_matrix=new mat4(+(d1),-(d2),+(d3),-(d4),-(this.m[1]*(this.m[10]*this.m[15]-this.m[14]*this.m[11])-this.m[2]*(this.m[9]*this.m[15]-this.m[13]*this.m[11])+this.m[3]*(this.m[9]*this.m[14]-this.m[13]*this.m[10])),+(this.m[0]*(this.m[10]*this.m[15]-this.m[14]*this.m[11])-this.m[2]*(this.m[8]*this.m[15]-this.m[12]*this.m[11])+this.m[3]*(this.m[8]*this.m[14]-this.m[12]*this.m[10])),-(this.m[0]*(this.m[9]*this.m[15]-this.m[13]*this.m[11])-this.m[1]*(this.m[8]*this.m[15]-this.m[12]*this.m[11])+this.m[3]*(this.m[8]*this.m[13]-this.m[12]*this.m[9])),+(this.m[0]*(this.m[9]*this.m[14]-this.m[13]*this.m[10])-this.m[1]*(this.m[8]*this.m[14]-this.m[12]*this.m[10])+this.m[2]*(this.m[8]*this.m[13]-this.m[12]*this.m[9])),+(this.m[1]*(this.m[6]*this.m[15]-this.m[14]*this.m[7])-this.m[2]*(this.m[5]*this.m[15]-this.m[13]*this.m[7])+this.m[3]*(this.m[5]*this.m[14]-this.m[13]*this.m[6])),-(this.m[0]*(this.m[6]*this.m[15]-this.m[14]*this.m[7])-this.m[2]*(this.m[4]*this.m[15]-this.m[12]*this.m[7])+this.m[3]*(this.m[4]*this.m[14]-this.m[12]*this.m[6])),+(this.m[0]*(this.m[5]*this.m[15]-this.m[13]*this.m[7])-this.m[1]*(this.m[4]*this.m[15]-this.m[12]*this.m[7])+this.m[3]*(this.m[4]*this.m[13]-this.m[12]*this.m[5])),-(this.m[0]*(this.m[5]*this.m[14]-this.m[13]*this.m[6])-this.m[1]*(this.m[4]*this.m[14]-this.m[12]*this.m[6])+this.m[2]*(this.m[4]*this.m[13]-this.m[12]*this.m[5])),-(this.m[1]*(this.m[6]*this.m[11]-this.m[10]*this.m[7])-this.m[2]*(this.m[5]*this.m[11]-this.m[9]*this.m[7])+this.m[3]*(this.m[5]*this.m[10]-this.m[9]*this.m[6])),+(this.m[0]*(this.m[6]*this.m[11]-this.m[10]*this.m[7])-this.m[2]*(this.m[4]*this.m[11]-this.m[8]*this.m[7])+this.m[3]*(this.m[4]*this.m[10]-this.m[8]*this.m[6])),-(this.m[0]*(this.m[5]*this.m[11]-this.m[9]*this.m[7])-this.m[1]*(this.m[4]*this.m[11]-this.m[8]*this.m[7])+this.m[3]*(this.m[4]*this.m[9]-this.m[8]*this.m[5])),+(this.m[0]*(this.m[5]*this.m[10]-this.m[9]*this.m[6])-this.m[1]*(this.m[4]*this.m[10]-this.m[8]*this.m[6])+this.m[2]*(this.m[4]*this.m[9]-this.m[8]*this.m[5])));cofactor_matrix.transpose();this.m=cofactor_matrix.m;this.m[0]/=det;this.m[1]/=det;this.m[2]/=det;this.m[3]/=det;this.m[4]/=det;this.m[5]/=det;this.m[6]/=det;this.m[7]/=det;this.m[8]/=det;this.m[9]/=det;this.m[10]/=det;this.m[11]/=det;this.m[12]/=det;this.m[13]/=det;this.m[14]/=det;this.m[15]/=det;return true;}
return false;};mat4.prototype.x_vector=function(){var arr=this.m.slice(0,4);return new vec4(arr[0],arr[1],arr[2],arr[3]);};mat4.prototype.y_vector=function(){var arr=this.m.slice(4,8);return new vec4(arr[0],arr[1],arr[2],arr[3]);};mat4.prototype.z_vector=function(){var arr=this.m.slice(8,12);return new vec4(arr[0],arr[1],arr[2],arr[3]);};mat4.prototype.w_vector=function(){var arr=this.m.slice(12,16);return new vec4(arr[0],arr[1],arr[2],arr[3]);};mat4.prototype.toString=function(){return"|"+this.m[0]+" "+this.m[4]+" "+this.m[8]+" "+this.m[12]+"|\n"+"|"+this.m[1]+" "+this.m[5]+" "+this.m[9]+" "+this.m[13]+"|\n"+"|"+this.m[2]+" "+this.m[6]+" "+this.m[10]+" "+this.m[14]+"|\n"+"|"+this.m[3]+" "+this.m[7]+" "+this.m[11]+" "+this.m[15]+"|\n";};function quat(x,y,z,w){this.x=x;this.y=y;this.z=z;this.w=w;}
quat.prototype.magnitude=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);};quat.prototype.normalize=function(){var magnitude=quat_magnitude(q);this.w/=magnitude;this.x/=magnitude;this.y/=magnitude;this.z/=magnitude;};quat.from_axis_angle=function(axis,angle){var q=new quat(Math.cos(angle/2.0),axis.x*Math.sin(angle/2.0),axis.y*Math.sin(angle/2.0),axis.z*Math.sin(angle/2.0));q.normalize();return q;};quat.from_vec=function(v){return new quat(v.x,v.y,v.z,0.0);};quat.from_mat3=function(m){var trace=m.m[0]+m.m[4]+m.m[8];if(trace>0.0)
{var s=0.5/Math.sqrt(trace);return new quat(0.25/s,(m.m[7]-m.m[5])*s,(m.m[2]-m.m[6])*s,(m.m[3]-m.m[1])*s);}
else
{var max_diagonal_elem=maxf(m.m[0],maxf(m.m[4],m.m[8]));if(Math.abs(m.m[0]-max_diagonal_elem)<SCALAR_EPSILON)
{var s=Math.sqrt(1.0+m.m[0]-m.m[4]-m.m[8])*2.0;return new quat(0.5/s,(m.m[1]+m.m[3])/s,(m.m[2]+m.m[6])/s,(m.m[5]+m.m[7])/s);}
else if(Math.abs(m.m[4]-max_diagonal_elem)<SCALAR_EPSILON)
{var s=Math.sqrt(1.0+m.m[4]-m.m[0]-m.m[8])*2.0;return new quat((m.m[1]+m.m[3])/s,0.5/s,(m.m[5]+m.m[7])/s,(m.m[2]+m.m[6])/s);}
else
{var s=Math.sqrt(1.0+m.m[8]-m.m[0]-m.m[4])*2.0;return new quat((m.m[2]+m.m[6])/s,(m.m[5]+m.m[7])/s,0.5/s,(m.m[1]+m.m[3])/s);}}};quat.from_mat4=function(m){var trace=m.m[0]+m.m[5]+m.m[10]+1;if(trace>0.0)
{var s=0.5/Math.sqrt(trace);return new quat(0.25/s,(m.m[9]-m.m[6])*s,(m.m[2]-m.m[8])*s,(m.m[4]-m.m[1])*s);}
else
{var max_diagonal_elem=maxf(m.m[0],maxf(m.m[5],m.m[10]));if(Math.abs(m.m[0]-max_diagonal_elem)<SCALAR_EPSILON)
{var s=Math.sqrt(1.0+m.m[0]-m.m[5]-m.m[10])*2.0;return new quat(0.5/s,(m.m[1]+m.m[4])/s,(m.m[2]+m.m[8])/s,(m.m[6]+m.m[9])/s);}
else if(Math.abs(m.m[5]-max_diagonal_elem)<SCALAR_EPSILON)
{var s=Math.sqrt(1.0+m.m[5]-m.m[0]-m.m[10])*2.0;return new quat((m.m[1]+m.m[4])/s,0.5/s,(m.m[6]+m.m[9])/s,(m.m[2]+m.m[8])/s);}
else
{var s=Math.sqrt(1.0+m.m[10]-m.m[0]-m.m[5])*2.0;return new quat((m.m[2]+m.m[8])/s,(m.m[6]+m.m[9])/s,0.5/s,(m.m[1]+m.m[4])/s);}}};quat.from_mat=function(m){if(m instanceof mat3){return quat.from_mat3(m);}
else{return quat.from_mat4(m);}};quat.prototype.add=function(q){return new quat(this.x+q.x,this.y+q.y,this.z+q.z,this.w+q.w);};quat.prototype.multiply=function(q){return new quat(this.w*q.x+this.x*q.w-this.y*q.z+this.z*q.y,this.w*q.y+this.x*q.z+this.y*q.w-this.z*q.x,this.w*q.z-this.x*q.y+this.y*q.x+this.z*q.w,this.w*q.w-this.x*q.x-this.y*q.y-this.z*q.z);};quat.prototype.scale=function(s){this.x*=s;;this.y*=s;this.z*=s;this.w*=s;};quat.prototype.dot_product=function(q){return this.x*q.x+this.y*q.y+this.z*q.z+this.w*q.w;};quat.prototype.conjugate=function(q){return new quat(-q.x,-q.y,-q.z,q.w);};quat.prototype.rotate=function(v){var q_v=quat.from_vec(v);var q_inverse=this.conjugate();var q_v_inverse=q_v.multiply(q_inverse);var q_result=q.multiply(q_v_inverse);return new vec4(q_result.x,q_result.y,q_result.z,0.0);};quat.prototype.to_mat3=function(){return new mat3(1-2*this.y*this.y-2*this.z*this.z,2*this.x*this.y+2*this.w*this.z,2*this.x*this.z-2*this.w*this.y,2*this.x*this.y-2*this.w*this.z,1-2*this.x*this.x-2*this.z*this.z,2*this.y*this.z+2*this.w*this.x,2*this.x*this.z+2*this.w*this.y,2*this.y*this.z-2*this.w*this.x,1-2*this.x*this.x-2*this.y*this.y);};quat.prototype.to_mat4=function(){return new mat4(1-2*this.y*this.y-2*this.z*this.z,2*this.x*this.y+2*this.w*this.z,2*this.x*this.z-2*this.w*this.y,0.0,2*this.x*this.y-2*this.w*this.z,1-2*this.x*this.x-2*this.z*this.z,2*this.y*this.z+2*this.w*this.x,0.0,2*this.x*this.z+2*this.w*this.y,2*this.y*this.z-2*this.w*this.x,1-2*this.x*this.x-2*this.y*this.y,0.0,0.0,0.0,0.0,1.0);};quat.prototype.angle=function(){return Math.acos(this.w)*2.0;};quat.prototype.extract_axis_and_angle=function(axis,angle){angle=Math.acos(this.w)*2.0;var sin_angle=Math.sin(0.5*angle);axis.x=this.x/sin_angle;axis.y=this.y/sin_angle;axis.z=this.z/sin_angle;if(axis instanceof vec4){axis.w=0.0;}};